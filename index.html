<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TV Service Survey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-purple': '#6d28d9',
                        'deep-black': '#0f0f13'
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #0f0f13 0%, #1a1a24 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .gradient-border {
            position: relative;
            z-index: 0;
            border-radius: 16px;
            overflow: hidden;
            padding: 4px;
            background: linear-gradient(to right, #0f0f13, #0f0f13),
                        linear-gradient(135deg, #8B5CF6, #7C3AED, #6d28d9);
            background-clip: padding-box, border-box;
            background-origin: padding-box, border-box;
        }
        
        .gradient-border::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(135deg, #8B5CF6, #7C3AED, #6d28d9);
            border-radius: 16px;
            z-index: -1;
        }
        
        .glow-effect {
            box-shadow: 0 0 15px rgba(109, 40, 217, 0.5);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            transition: all 0.3s ease;
        }
        
        .btn-purple:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(109, 40, 217, 0.4);
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(109, 40, 217, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(109, 40, 217, 0); }
            100% { box-shadow: 0 0 0 0 rgba(109, 40, 217, 0); }
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: #8B5CF6 !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2) !important;
        }
        
        input:invalid, textarea:invalid, select:invalid {
            border-color: #ef4444 !important;
        }
        
        .invalid-feedback {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        input:invalid + .invalid-feedback,
        textarea:invalid + .invalid-feedback,
        select:invalid + .invalid-feedback {
            display: block;
        }
        
        .location-dot {
            color: #7C3AED;
        }
        
        .success-container {
            display: none;
        }
        
        .fade-in {
            animation: fadeIn 0.6s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-deep-black text-gray-100 flex items-center justify-center p-4 md:p-8">
    <div class="w-full max-w-2xl">
        <!-- Form Card -->
        <div id="registrationForm" class="gradient-border glow-effect">
            <div class="bg-dark-purple rounded-t-xl p-6">
                <div class="flex items-center space-x-4">
                    <div class="bg-black p-3 rounded-full">
                        <i class="fas fa-tv text-2xl text-purple-400"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-white">TV Service Survey</h1>
                        <p class="text-purple-200">Please provide your details for service</p>
                    </div>
                </div>
            </div>
            
            <form id="tvServiceForm" class="bg-gray-900 rounded-b-xl p-6 md:p-8 space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Full Name</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-user text-purple-500"></i>
                        </div>
                        <input type="text" id="name" name="name" required class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 p-3 focus:outline-none" placeholder="John Doe">
                        <div class="invalid-feedback">Please enter your full name</div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Address</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-map-marker-alt text-purple-500"></i>
                        </div>
                        <input type="text" id="address" name="address" required class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 p-3 focus:outline-none" placeholder="123 Main St, City">
                        <div class="invalid-feedback">Please enter your address</div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Phone Number</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-phone text-purple-500"></i>
                        </div>
                        <input type="tel" id="phone" name="phone" required class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 p-3 focus:outline-none" placeholder="(123) 456-7890" pattern="[0-9]{10}">
                        <div class="invalid-feedback">Please enter a valid 10-digit phone number</div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Remarks</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 pt-3">
                            <i class="fas fa-comment text-purple-500"></i>
                        </div>
                        <textarea id="remarks" name="remarks" required class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 p-3 focus:outline-none h-32" placeholder="Describe your TV issue or any special requirements"></textarea>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-3">Which type of TV do you have?<span class="text-red-500">*</span></label>
                    <div class="invalid-feedback mb-2" id="tvTypeError">Please select your TV type</div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <input type="radio" id="crt" name="tvType" value="CRT" class="hidden peer" required>
                            <label for="crt" class="flex items-center p-3 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer peer-checked:border-purple-500 peer-checked:bg-purple-900/30 hover:bg-gray-750 transition">
                                <div class="flex items-center w-full">
                                    <div class="bg-black p-2 rounded mr-3">
                                        <i class="fas fa-tv text-purple-500"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">CRT TV</div>
                                        <div class="text-xs text-gray-400">Cathode Ray Tube</div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <div>
                            <input type="radio" id="led" name="tvType" value="LED" class="hidden peer" required>
                            <label for="led" class="flex items-center p-3 bg-gray-800 border border-gray-700 rounded-lg cursor-pointer peer-checked:border-purple-500 peer-checked:bg-purple-900/30 hover:bg-gray-750 transition">
                                <div class="flex items-center w-full">
                                    <div class="bg-black p-2 rounded mr-3">
                                        <i class="fas fa-tv text-purple-500"></i>
                                    </div>
                                    <div>
                                        <div class="font-medium">LED TV</div>
                                        <div class="text-xs text-gray-400">Light Emitting Diode</div>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-1">Which TV connection do you have?<span class="text-red-500">*</span></label>
                    <div class="invalid-feedback mb-2" id="connectionError">Please select your TV connection</div>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3">
                            <i class="fas fa-satellite-dish text-purple-500"></i>
                        </div>
                        <select id="connectionType" name="connectionType" required class="w-full bg-gray-800 border border-gray-700 text-white rounded-lg pl-10 p-3 focus:outline-none appearance-none">
                            <option value="" disabled selected>Select your TV connection</option>
                            <option value="D2H">D2H</option>
                            <option value="Airtel">Airtel</option>
                            <option value="Jio">Jio</option>
                            <option value="Tata Sky">Tata Sky</option>
                            <option value="UCN">UCN</option>
                            <option value="Free Dish">Free Dish</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                            <i class="fas fa-chevron-down text-gray-500"></i>
                        </div>
                    </div>
                </div>
                
                <div class="p-4 bg-gray-800 rounded-lg border border-gray-700">
                    <div class="flex items-center">
                        <i class="fas fa-location-dot text-2xl location-dot"></i>
                        <div class="ml-3">
                            <div class="font-medium">Location Capture</div>
                            <div class="text-sm text-gray-400">We'll automatically capture your location for service</div>
                        </div>
                    </div>
                    <div id="locationStatus" class="mt-3 p-2 bg-black/40 rounded text-purple-300 text-sm flex items-center">
                        <i class="fas fa-sync-alt fa-spin mr-2"></i>
                        <span>Capturing your location...</span>
                    </div>
                    <input type="hidden" id="latitude" name="latitude">
                    <input type="hidden" id="longitude" name="longitude">
                </div>
                
                <div>
                    <button type="submit" class="w-full btn-purple text-white font-medium rounded-lg py-3.5 px-4 transition">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Request
                    </button>
                </div>
            </form>
        </div>
        
        <!-- Success Message -->
        <div id="successContainer" class="success-container">
            <div class="gradient-border glow-effect fade-in">
                <div class="bg-gray-900 rounded-xl p-8 md:p-10 flex flex-col items-center text-center">
                    <div class="w-16 h-16 rounded-full bg-purple-900 flex items-center justify-center mb-6">
                        <i class="fas fa-check-circle text-3xl text-purple-400"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-white mb-4">Request Submitted!</h2>
                    <p class="text-lg text-gray-300 mb-8">
                        ✅ Thank you! Your response has been successfully recorded. Our technician will contact you shortly.
                    </p>
                    <div class="p-4 bg-gray-800 rounded-lg w-full max-w-md">
                        <div class="text-gray-400 text-sm mb-2">Service Details</div>
                        <div id="serviceDetails" class="text-left text-gray-200 text-sm space-y-2"></div>
                        <div id="errorMessage" class="hidden mt-4 text-red-400">
                            <i class="fas fa-exclamation-triangle mr-2"></i>
                            <span>Failed to submit data. Please try again later.</span>
                            <button id="retryButton" class="ml-4 btn-purple text-sm px-3 py-1 rounded">Retry</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get user location
        function getLocation() {
            if (navigator.geolocation) {
               navigator.geolocation.getCurrentPosition(
    function(position) {
        document.getElementById('latitude').value = position.coords.latitude;
        document.getElementById('longitude').value = position.coords.longitude;
        document.getElementById('locationStatus').innerHTML = `
            <i class="fas fa-check-circle text-green-500 mr-2"></i>
            <span>Location captured: ${position.coords.latitude.toFixed(4)}, ${position.coords.longitude.toFixed(4)}</span>
        `;
    },
    function(error) {
        let message = '';
        switch (error.code) {
            case error.PERMISSION_DENIED:
                message = "Location permission denied. Please allow access.";
                break;
            case error.POSITION_UNAVAILABLE:
                message = "Location unavailable. Try again.";
                break;
            case error.TIMEOUT:
                message = "Location timed out. Try again.";
                break;
            default:
                message = "An unknown error occurred.";
        }

        document.getElementById('locationStatus').innerHTML = `
            <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
            <span>${message}</span>
        `;
        document.getElementById('locationStatus').classList.add('pulse');
    },
    {
        enableHighAccuracy: true,
        timeout: 10000,  // ⏱️ 10-second limit
        maximumAge: 0
    }
);

        // Form submission handler
        document.getElementById('tvServiceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            const form = e.target;
            let isValid = true;
            
            // Check all required fields
            let firstInvalid = null;
            
            // Text inputs, textarea and select
            const requiredInputs = form.querySelectorAll('[required]');
            requiredInputs.forEach(input => {
                input.classList.remove('border-red-500');
                if (!input.value) {
                    input.classList.add('border-red-500');
                    isValid = false;
                    if (!firstInvalid) firstInvalid = input;
                }
            });
            
            // Radio buttons (TV Type)
            const tvTypeChecked = form.querySelector('input[name="tvType"]:checked');
            if (!tvTypeChecked) {
                document.getElementById('tvTypeError').style.display = 'block';
                isValid = false;
                if (!firstInvalid) firstInvalid = document.getElementById('tvTypeError');
            } else {
                document.getElementById('tvTypeError').style.display = 'none';
            }
            
            // Connection Type select
            const connectionType = form.querySelector('#connectionType');
            if (!connectionType.value) {
                document.getElementById('connectionError').style.display = 'block';
                isValid = false;
                if (!firstInvalid) firstInvalid = connectionType;
            } else {
                document.getElementById('connectionError').style.display = 'none';
            }
            
            if (!isValid) {
                // Scroll to first invalid element
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
                return;
            }
            
            // Check location was captured
            const latitude = document.getElementById('latitude').value;
            const longitude = document.getElementById('longitude').value;
            
            if(!latitude || !longitude) {
                alert('We need your location to provide service. Please enable location services.');
                document.getElementById('locationStatus').classList.add('pulse');
                return;
            }
            
            // Prepare form data
            const tvType = document.querySelector('input[name="tvType"]:checked');
const connectionType = document.getElementById('connectionType');

const formData = {
    name: document.getElementById('name').value,
    address: document.getElementById('address').value,
    phone: document.getElementById('phone').value,
    remarks: document.getElementById('remarks').value,
    tvType: tvType ? tvType.value : '',
    connectionType: connectionType.value || '',
    latitude: document.getElementById('latitude').value,
    longitude: document.getElementById('longitude').value
};

            
            
            // Prepare service details for display
            document.getElementById('serviceDetails').innerHTML = `
                <div><span class="text-gray-500">Name:</span> ${formData.name}</div>
                <div><span class="text-gray-500">TV Type:</span> ${formData.tvType}</div>
                <div><span class="text-gray-500">Connection:</span> ${formData.connectionType}</div>
                <div><span class="text-gray-500">Location:</span> ${latitude.substring(0,7)}, ${longitude.substring(0,7)}</div>
                <div><span class="text-gray-500">Service ETA:</span> Within 24 hours</div>
            `;
            
            // Disable submit button
            const submitBtn = document.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Submitting...';

            // Show the success container
            document.getElementById('registrationForm').classList.add('hidden');
            document.getElementById('successContainer').style.display = 'block';
            
            // Send data to Google Apps Script
            fetch('https://script.google.com/macros/s/AKfycbyfmDkX1VJTr48jSpnZh9RpoKGX5Zlekkk3i8XRps29sBpDHmYxZCLnEsLibxtD_FDU/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            })
            .then(() => {
                // In 'no-cors' mode we can't read the response directly
                console.log('Request sent (response details not available in no-cors mode)');
                document.getElementById('errorMessage').classList.add('hidden');
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('errorMessage').classList.remove('hidden');
            });
        });

        // Initialize location capture
        getLocation();

        // Retry button functionality
        document.getElementById('retryButton')?.addEventListener('click', function() {
            document.getElementById('errorMessage').classList.add('hidden');
            document.getElementById('tvServiceForm').dispatchEvent(new Event('submit'));
        });
    </script>
</body>
</html>
